<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Recursive Backtrack</title>
  <link rel="stylesheet" href="css/styles.css?v=1.0">
</head>
 
<body style="background-color: #444; width: 100%; height: 100%;">
  <canvas id="RecursiveBacktrackMazeCanvas" width="600" height="600" style="border:1px solid white; background-color: #222;"></canvas>
    <button onclick="Go()">Generate</button>
    <div id="Controls">
      <div id="MazeSize">
        <div id="HeightInputContainer">
          <label>Maze Height</label>
          <input type="number" min="2" max="50" value="10" id="MazeHeightInput">
        </div>
        <div id="WidthInputContainer">
          <label>Maze Width</label>
          <input type="number" min="2" max="50" value="10" id="MazeWidthInput">
        </div>
      </div>
      <div id="IntervalSpeed">
        <label>Vizualisation step speed (set to 0 to disable visualisation)</label>
        <input type="range" min="0" max="100" value="50" class="slider" id="stepInterval">
      </div>
    </div>
    
    <script src="./RecursiveBacktrackGenerator.js"></script>
    <script src="../../Solvers/RecursiveBacktrackSolver.js"></script>
    <script src="../../utils/Illustrator.js"></script>
    <script src="../../utils/FindNeighbours.js"></script>
    <script>
      let gameCanvas = document.getElementById("RecursiveBacktrackMazeCanvas");

      let ctx = gameCanvas.getContext("2d");

      let inProgress = false;

      function Go()
      {
          var height = document.getElementById("MazeHeightInput").value;
          var width = document.getElementById("MazeWidthInput").value;
          var stepInterval = document.getElementById("stepInterval").value;

          Generate(height, width, stepInterval)
      }

      function Generate(mazeHeight = 10, mazeWidth = 10, stepInterval)
      {
          if (inProgress) return;
          inProgress = true;
          let startCoords = {row: 0, col: 0};
          let endCoords = {row: mazeHeight - 1, col: mazeWidth - 1};

          let illustrator = new Illustrator(ctx, mazeWidth, mazeHeight);
          
          let maze = new RecursiveBacktrackMazeGen(
              mazeHeight, mazeWidth, startCoords, endCoords, 
              (...args) => CompletedCallback(...args, illustrator));

          
          // interval of 0 means don't animate steps.
          if (stepInterval != 0)
          {
              let interval = setInterval(function(){ 
                  if (!maze.completed)
                  {
                      maze.StepMaze();
                      maze.Draw(illustrator);
                  }
                  else
                  {
                      clearInterval(interval);
                  }
              }, stepInterval);
          }
          else
          {
              while(!maze.completed)
              {
                  maze.StepMaze();
              }

              maze.Draw(illustrator);
          }
      }

      function CompletedCallback(maze, illustrator)
      {
          inProgress = false;

          // final draw cycle to remove dots
          illustrator.DrawGrid();

          maze.forEach(row => row.forEach(cell => illustrator.DrawWallBreaks(cell)));

          Solve(maze, illustrator);
      }

      function Solve(maze, illustrator)
      {
          let solver = new RecursiveBacktrackMazeSolver(maze, {row: 0, col: 0}, {row: maze.length - 1, col: maze[0].length - 1}, () => console.log("done"));

          let interval = setInterval(function(){ 
              if (!solver.completed)
              {
                  solver.StepMaze();
                  solver.Draw(illustrator);
              }
              else
              {
                  clearInterval(interval);
              }
          }, 10);
      }
    </script>
</body>
</html>